<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="com.bitcamp.Mapper.CategoryMapper">
    <parameterMap type="java.util.HashMap" id="hashmap"></parameterMap>
    <resultMap type="com.bitcamp.DTO.FileVo" id="imgdto"></resultMap>
    	<select id="AllList" resultType="com.bitcamp.DTO.CategoryDTO">
    		
    		select cno,cname from category
 
    		
    	</select>
    	<select id="totalCountcount" parameterMap="hashmap" resultType="int">
  	  		
  	  		select count(*) from product
  	  		
  	<where>
  		<if test="searchtxt!=null and searchtxt!=''">
  			<choose>
  				<when test="search=='pno'">
  				and pno=#{searchtxt}
  				</when>
  				<when test="search=='pname'">
  					and pname like '%'||upper(#{searchtxt})||'%'     
  				</when>
  				<when test="search=='cno'">
  				and cno=#{searchtxt}
  				</when>
  			</choose>
  		</if>
  	</where>
  </select>
  <select id="plist" parameterMap="hashmap" resultType="com.bitcamp.DTO.CategoryDTO">
  		select *
  		from product
  		
              <where>
				<if test="searchtxt!=null and searchtxt!=''">
				<choose>
					<when test="search=='pno'">
						and pno=#{searchtxt}
					</when>
					<when test="search=='pname'">
						and pname like upper('%'|| #{searchtxt}||'%')
					</when>
					<when test="search=='cno'">
						and cno=#{searchtxt}
					</when>
				</choose>
			</if>
			
	</where>
	order by pno
	limit #{startRow}, #{endRow}
  </select>
  
    	<select id="allList" resultType="com.bitcamp.DTO.CategoryDTO">
    	
    		select cno,cname from category
    	
    	</select>
    	
    	
    	<select id="cpList" resultType="com.bitcamp.DTO.CategoryDTO" parameterType="int">
    	
    		select p.pname, p.dprice, p.oprice
    		from category c, product p 
    		where c.cno = p.cno 
    		and p.cno = #{cno}
    	
    	</select>
  		<insert id="addresult" parameterType="com.bitcamp.DTO.CategoryDTO">
    	
    		insert into product(pname, dprice, oprice, cno, content)
    		 values(#{pname}, #{dprice}, #{oprice}, #{cno}, #{content})
    		 
    	 	
    	 
    	
    	</insert>
    	
    	<insert id="addallresult" parameterMap="hashmap">
    	 <selectKey keyProperty="pno" resultType="int" order="BEFORE">
    		    select max(pno)
    		    from product
    		 </selectKey>
    	 
    	 
    	 insert into img(pno, imgname)
    	 value(#{pno}, #{path} )
    	</insert>
  		
    	
    	<delete id="delete" parameterType="int">
    	
    		delete from product where pno = #{pno}
    	
    	</delete>
    	
    	 
 <select id="totalCount" parameterMap="hashmap" resultType="int">
  	  		
  	  		select count(*) from product
  	  		
  	<where>
  		<if test="searchtxt!=null and searchtxt!=''">
  			<choose>
  				<when test="search=='pno'">
  				and pno=#{searchtxt}
  				</when>
  				<when test="search=='pname'">
  					and pname like '%'||upper(#{searchtxt})||'%'     
  				</when>
  				<when test="search=='cno'">
  				and cno=#{searchtxt}
  				</when>
  			</choose>
  		</if>
  	</where>
  </select>
  
  <select id="list" parameterMap="hashmap" resultType="com.bitcamp.DTO.CategoryDTO">
  		select *
  		from product
  		
              <where>
				<if test="searchtxt!=null and searchtxt!=''">
				<choose>
					<when test="search=='pno'">
						and pno=#{searchtxt}
					</when>
					<when test="search=='pname'">
						and pname like upper('%'|| #{searchtxt}||'%')
					</when>
					<when test="search=='cno'">
						and cno=#{searchtxt}
					</when>
				</choose>
			</if>
			
	</where>
	order by pno
	limit #{startRow}, #{endRow}
  </select>
    	
    	<select id="update" parameterType="int" resultType="com.bitcamp.DTO.CategoryDTO">
    	
    		select * 
    		from product
    		where pno=#{pno}
    	
    	</select>
    	
    	<update id="updateresult" parameterType="com.bitcamp.DTO.CategoryDTO">
    		update product
    		set 
    			 pname= #{pname}
    			,oprice =#{oprice}
    			,dprice =#{dprice}
    			,content =#{content}
    		where 
    			pno=#{pno}
    			
    	</update>
    	
    	<select id="admincategorylist" resultType="com.bitcamp.DTO.CategoryDTO" >
    	
    		select cno,cname from category
    	
    	
    	</select>
    	
    	<select id="adallList" resultType="com.bitcamp.DTO.CategoryDTO">
    	
    		select cno,cname from category
    		
    	</select>
    	<select id="adcpList" resultType="com.bitcamp.DTO.CategoryDTO" parameterType="int">
    	
    		select p.pname, p.dprice, p.oprice
    		from category c, product p 
    		where c.cno = p.cno 
    		and p.cno = #{cno}
    	</select>
    	
    	
    	<!-- <insert id="payok" parameterType="com.bitcamp.DTO.payMemberDTO">
    	
    		insert into member()
    	
    	
    	</insert> -->
    	
    	
    	
    	
    	
    </mapper>